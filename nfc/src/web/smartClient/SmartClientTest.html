<!DOCTYPE html>

<html>

<head>

    <script type="text/javascript" language="javascript" src="jquery.js"></script>

    <script>
        jQuery.noConflict();
    </script>

    <script type="text/javascript"
            language="javascript"
            src="smartClient.SmartClient/smartClient.SmartClient.nocache.js">
    </script>

    <script type="text/javascript">

        jQuery(document).ready(function () {
            jQuery("#buttons button").attr('disabled', 'disabled');
        });

        var threedSession;

        function initThreed() {

            var factory = new smartClient.ThreedSessionFactory();

            factory.setBrandKey("toyota");
            factory.setProfileKey("wStd");
            factory.setSeriesKey(2011, "avalon");

            var threedSessionFuture = factory.createSession();

            threedSessionFuture.success(function () {
                threedSession = threedSessionFuture.getResult();
                jQuery("#buttons button").removeAttr('disabled');
                threedSession.setPicks(["Base", "V6", "6AT", "070"]);


//                threedSession.addImageChangeListener1(function () {
//                    console.log("imageBatch1: " + threedSession.getImageBatch());
//                    refreshView();
//                });

                threedSession.addImageChangeListener2(function () {
                    console.log("imageBatch2: " + threedSession.getImageBatch());
                    refreshView();
                });
            });


        }


        function refreshView() {
            jQuery("#view").html(threedSession.getView());
            jQuery("#angle").html(threedSession.getAngle().toString());
            jQuery("#urls").html(threedSession.getImageBatch().toString());

            var imageBatch = threedSession.getImageBatch();
            var images = imageBatch.getImageArray();
            var maxImageIndex = images.length - 1;

            var a1 = jQuery("#imageStack img");
            a1.each(function (index, imageElement) {
                var img = jQuery(imageElement);
                if (index <= maxImageIndex) {
                    img.show();
                    var image = images[index];
                    console.log(index + " " + image.getSrc());
                    img.attr("src", image.getSrc());
                } else {
                    img.hide();
                }

            });

//            images.forEach(function (image) {
//                console.log("ii");
//                jQuery("#threedImage").attr("src", image.getSrc());
//            });


        }

    </script>

    <style>
        img {
            width: 599px;
            height: 366px;
            position: absolute;
        }
    </style>
</head>
<body style="padding: 1em">


<div id="buttons">

    <!--<button onclick="refreshView()">Refresh View</button>-->
    <button onclick="threedSession.setImageModeString('JPG')">JPG Mode</button>
    <button onclick="threedSession.setImageModeString('PNG')">PNG Mode</button>

    <div style="padding-bottom: 2em">
        <button onclick="threedSession.previousAngle()">&lt;&lt;</button>
        <button onclick="threedSession.nextAngle()">&gt;&gt;</button>
    </div>

    <div style="padding-bottom: 2em;">
        <button onclick="threedSession.setPicks(['Base', 'V6', '6AT', '202']);">'Base', 'V6', '6AT', '202'</button>
        <button onclick="threedSession.setPicks(['LTD', 'V6', '6AT', '8N0']);">'LTD', 'V6', '6AT', '8N0'</button>
    </div>
</div>

<div style="position: relative;" id="imageStack">
    <img style="z-index: 10">
    <img style="z-index: 20">
    <img style="z-index: 30">
    <img style="z-index: 40">
    <img style="z-index: 50">
    <img style="z-index: 60">
    <img style="z-index: 70">
    <img style="z-index: 80">
    <img style="z-index: 90">
    <img style="z-index: 100">
</div>


<div style="display: none;">
    <table border="1" cellpadding='5'>
        <tr>
            <td>View</td>
            <td>
                <div id="view"></div>
            </td>
        </tr>
        <tr>
            <td>Angle</td>
            <td>
                <div id="angle"></div>
            </td>
        </tr>
        <tr>
            <td>URLs</td>
            <td>
                <div id="urls"></div>
            </td>
        </tr>

    </table>
</div>


</body>
</html>
